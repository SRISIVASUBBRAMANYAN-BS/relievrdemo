<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RelieVR - VR Therapy for Recovery</title>
    <style>
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        body {
          font-family: "Inter", sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
          min-height: 100vh;
          color: #333;
        }

        .app-container {
          max-width: 1200px;
          margin: 0 auto;
          background: white;
          min-height: 100vh;
          box-shadow: 0 0 40px rgba(0, 0, 0, 0.15);
        }

        .header {
          background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 50%, #45b7d1 100%);
          color: white;
          padding: 2rem;
          text-align: center;
        }

        .logo-section {
          display: flex;
          justify-content: space-between;
          align-items: center;
          max-width: 1000px;
          margin: 0 auto;
        }

        .srm-logo-placeholder {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 1rem;
          border: 2px dashed rgba(255, 255, 255, 0.5);
          border-radius: 12px;
          background: rgba(255, 255, 255, 0.1);
          min-width: 120px;
        }

        .srm-logo-placeholder i {
          font-size: 2rem;
          margin-bottom: 0.5rem;
        }

        .srm-logo-placeholder span {
          font-size: 0.9rem;
          font-weight: 500;
          opacity: 0.8;
        }

        .relievr-branding {
          flex: 1;
          margin: 0 2rem;
        }

        .relievr-branding .logo {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 1rem;
          margin-bottom: 0.5rem;
        }

        .relievr-branding .logo i {
          font-size: 3rem;
          color: #ffeaa7;
        }

        .relievr-branding h1 {
          font-size: 3.5rem;
          font-weight: 700;
          background: linear-gradient(45deg, #ffeaa7, #fab1a0);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .tagline {
          font-size: 1.2rem;
          opacity: 0.9;
          font-weight: 300;
          margin-top: 0.5rem;
        }

        .progress-container {
          padding: 1rem 2rem;
          background: linear-gradient(90deg, #a8edea 0%, #fed6e3 100%);
          border-bottom: 1px solid #e9ecef;
        }

        .progress-bar {
          width: 100%;
          height: 10px;
          background: rgba(255, 255, 255, 0.3);
          border-radius: 5px;
          overflow: hidden;
          margin-bottom: 0.5rem;
        }

        .progress-fill {
          height: 100%;
          background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
          width: 25%;
          transition: width 0.3s ease;
        }

        .main-content {
          padding: 2rem;
        }

        .step-section {
          display: none;
          animation: fadeIn 0.5s ease;
        }

        .step-section.active {
          display: block;
        }

        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .step-header {
          text-align: center;
          margin-bottom: 2rem;
        }

        .step-header h2 {
          font-size: 2.2rem;
          color: #2c3e50;
          margin-bottom: 0.5rem;
        }

        .step-header h2 i {
          margin-right: 0.5rem;
          color: #ff6b6b;
        }

        .step-header p {
          color: #6c757d;
          font-size: 1.1rem;
        }

        .btn-primary {
          background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 50%, #45b7d1 100%);
          color: white;
          border: none;
          padding: 1.2rem 2.5rem;
          border-radius: 12px;
          font-size: 1.1rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 0.5rem;
          margin: 2rem auto 0;
          box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
          min-width: 200px;
        }

        .btn-primary:hover {
          transform: translateY(-3px);
          box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .btn-secondary {
          background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
          color: #2c3e50;
          border: none;
          padding: 0.75rem 1.5rem;
          border-radius: 8px;
          font-size: 1rem;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.3s ease;
        }

        .btn-secondary:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 15px rgba(168, 237, 234, 0.3);
        }

        .info-form-container {
          max-width: 600px;
          margin: 0 auto;
        }

        .form-card {
          background: white;
          padding: 2.5rem;
          border-radius: 20px;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
          border-left: 6px solid #ff6b6b;
        }

        .form-group {
          margin-bottom: 2rem;
        }

        .form-group label {
          display: flex;
          align-items: center;
          font-size: 1.1rem;
          font-weight: 600;
          color: #2c3e50;
          margin-bottom: 0.75rem;
        }

        .form-group label i {
          margin-right: 0.75rem;
          color: #ff6b6b;
          font-size: 1.2rem;
        }

        .form-group input,
        .form-group select {
          width: 100%;
          padding: 1rem 1.25rem;
          border: 2px solid #e9ecef;
          border-radius: 12px;
          font-size: 1rem;
          transition: all 0.3s ease;
          background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }

        .form-group input:focus,
        .form-group select:focus {
          outline: none;
          border-color: #ff6b6b;
          box-shadow: 0 0 0 4px rgba(255, 107, 107, 0.1);
          background: white;
        }

        .questionnaire-container {
          max-width: 800px;
          margin: 0 auto;
        }

        .question-card {
          background: white;
          padding: 2rem;
          border-radius: 16px;
          box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
          margin-bottom: 2rem;
          border-left: 6px solid #ff6b6b;
        }

        .question-header {
          display: flex;
          align-items: center;
          margin-bottom: 1rem;
        }

        .question-number {
          background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
          color: white;
          width: 35px;
          height: 35px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: 600;
          margin-right: 1rem;
        }

        .question-text {
          font-size: 1.2rem;
          font-weight: 500;
          color: #2c3e50;
        }

        .emoji-options {
          display: flex;
          justify-content: center;
          gap: 1rem;
          margin: 1.5rem 0;
          flex-wrap: wrap;
        }

        .emoji-option {
          font-size: 3rem;
          padding: 1rem;
          border: 3px solid transparent;
          border-radius: 16px;
          cursor: pointer;
          transition: all 0.3s ease;
          background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        .emoji-option:hover {
          transform: scale(1.1);
          border-color: #ff6b6b;
        }

        .emoji-option.selected {
          border-color: #ff6b6b;
          background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);
          transform: scale(1.1);
        }

        .scale-options {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin: 1.5rem 0;
          padding: 1rem;
          background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
          border-radius: 12px;
        }

        .scale-option {
          width: 45px;
          height: 45px;
          border-radius: 50%;
          border: 2px solid #e9ecef;
          background: white;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: 600;
          transition: all 0.3s ease;
        }

        .scale-option:hover {
          border-color: #ff6b6b;
          background: #ff6b6b;
          color: white;
          transform: scale(1.1);
        }

        .scale-option.selected {
          border-color: #ff6b6b;
          background: #ff6b6b;
          color: white;
          transform: scale(1.1);
        }

        .color-options {
          display: flex;
          justify-content: center;
          gap: 1rem;
          margin: 1.5rem 0;
          flex-wrap: wrap;
        }

        .color-option {
          width: 60px;
          height: 60px;
          border-radius: 50%;
          cursor: pointer;
          border: 4px solid transparent;
          transition: all 0.3s ease;
        }

        .color-option:hover {
          transform: scale(1.1);
          border-color: #ff6b6b;
        }

        .color-option.selected {
          border-color: #ff6b6b;
          transform: scale(1.2);
          box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .vr-container {
          max-width: 800px;
          margin: 0 auto;
        }

        .therapy-recommendation {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
          color: white;
          padding: 2rem;
          border-radius: 16px;
          margin-bottom: 2rem;
          text-align: center;
          box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        .vr-status {
          background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
          padding: 2rem;
          border-radius: 16px;
          margin-bottom: 2rem;
          text-align: center;
        }

        .vr-message {
          margin-bottom: 2rem;
        }

        .vr-message i {
          font-size: 3rem;
          color: #ff6b6b;
          margin-bottom: 1rem;
        }

        .vr-message h3 {
          font-size: 1.5rem;
          color: #2c3e50;
          margin-bottom: 0.5rem;
        }

        .vr-features {
          display: flex;
          justify-content: center;
          gap: 1rem;
          margin-top: 1rem;
          flex-wrap: wrap;
        }

        .feature-tag {
          background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
          color: white;
          padding: 0.5rem 1rem;
          border-radius: 20px;
          font-size: 0.9rem;
          font-weight: 500;
        }

        .session-timer {
          text-align: center;
          font-size: 1.5rem;
          font-weight: 600;
          color: #ff6b6b;
          margin: 1rem 0;
        }

        .vr-fullscreen-modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: #000;
          z-index: 9999;
        }

        .vr-fullscreen-modal.active {
          display: block;
        }

        .vr-overlay {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          color: white;
          z-index: 10000;
        }

        .vr-header {
          position: absolute;
          top: 2rem;
          left: 50%;
          transform: translateX(-50%);
          text-align: center;
          z-index: 10001;
        }

        .vr-header h3 {
          font-size: 1.5rem;
          margin-bottom: 0.5rem;
        }

        .session-info {
          display: flex;
          gap: 2rem;
          font-size: 1rem;
          opacity: 0.8;
        }

        .vr-progress {
          position: absolute;
          bottom: 4rem;
          left: 50%;
          transform: translateX(-50%);
          width: 80%;
          max-width: 600px;
          text-align: center;
          z-index: 10001;
        }

        .vr-progress-bar {
          width: 100%;
          height: 8px;
          background: rgba(255, 255, 255, 0.3);
          border-radius: 4px;
          overflow: hidden;
          margin-bottom: 1rem;
        }

        .vr-progress-fill {
          height: 100%;
          background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
          width: 0%;
          transition: width 0.5s ease;
        }

        .emergency-exit {
          position: absolute;
          top: 2rem;
          right: 2rem;
          background: rgba(255, 107, 107, 0.8);
          border: 2px solid rgba(255, 255, 255, 0.5);
          color: white;
          padding: 0.75rem 1rem;
          border-radius: 8px;
          cursor: pointer;
          font-size: 1rem;
          transition: all 0.3s ease;
          z-index: 10001;
        }

        .emergency-exit:hover {
          background: rgba(255, 107, 107, 1);
          border-color: rgba(255, 255, 255, 0.8);
        }

        #vrVideo {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .results-container {
          max-width: 800px;
          margin: 0 auto;
        }

        .result-card {
          background: white;
          padding: 2rem;
          border-radius: 16px;
          box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
          margin-bottom: 2rem;
          border-left: 6px solid #45b7d1;
        }

        .result-header {
          display: flex;
          align-items: center;
          margin-bottom: 1rem;
        }

        .result-icon {
          font-size: 2rem;
          margin-right: 1rem;
          color: #45b7d1;
        }

        .improvement-bar {
          width: 100%;
          height: 20px;
          background: #e9ecef;
          border-radius: 10px;
          overflow: hidden;
          margin: 1rem 0;
        }

        .improvement-fill {
          height: 100%;
          background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
          transition: width 1s ease;
        }

        .followup-schedule {
          margin: 2rem 0;
        }

        .schedule-card {
          background: white;
          padding: 2rem;
          border-radius: 16px;
          box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
          border-left: 6px solid #4ecdc4;
        }

        .schedule-header {
          display: flex;
          align-items: center;
          margin-bottom: 2rem;
        }

        .schedule-header i {
          font-size: 2rem;
          color: #4ecdc4;
          margin-right: 1rem;
        }

        .schedule-header h3 {
          font-size: 1.5rem;
          color: #2c3e50;
        }

        .schedule-timeline {
          position: relative;
          padding-left: 2rem;
        }

        .schedule-timeline::before {
          content: "";
          position: absolute;
          left: 15px;
          top: 0;
          bottom: 0;
          width: 2px;
          background: linear-gradient(to bottom, #ff6b6b, #4ecdc4, #45b7d1);
        }

        .timeline-item {
          position: relative;
          margin-bottom: 2rem;
          padding-left: 2rem;
        }

        .timeline-dot {
          position: absolute;
          left: -7px;
          top: 5px;
          width: 14px;
          height: 14px;
          border-radius: 50%;
          background: #ff6b6b;
          border: 3px solid white;
          box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .timeline-item:nth-child(2) .timeline-dot {
          background: #4ecdc4;
          box-shadow: 0 2px 8px rgba(78, 205, 196, 0.3);
        }

        .timeline-item:nth-child(3) .timeline-dot {
          background: #45b7d1;
          box-shadow: 0 2px 8px rgba(69, 183, 209, 0.3);
        }

        .timeline-content h4 {
          font-size: 1.2rem;
          color: #2c3e50;
          margin-bottom: 0.5rem;
        }

        .timeline-content p {
          font-weight: 600;
          color: #ff6b6b;
          margin-bottom: 0.25rem;
        }

        .timeline-content small {
          color: #6c757d;
        }

        .action-buttons {
          display: flex;
          justify-content: center;
          gap: 1rem;
          margin-top: 2rem;
        }

        @media (max-width: 768px) {
          .logo-section {
            flex-direction: column;
            gap: 1rem;
          }

          .relievr-branding h1 {
            font-size: 2.5rem;
          }

          .main-content {
            padding: 1rem;
          }

          .form-card {
            padding: 1.5rem;
            margin: 0 1rem;
          }

          .emoji-options {
            gap: 0.5rem;
          }

          .emoji-option {
            font-size: 2rem;
            padding: 0.5rem;
          }

          .action-buttons {
            flex-direction: column;
            align-items: center;
          }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="srm-logo-placeholder">
                        <i class="fas fa-vr-cardboard"></i>
                        <span>RelieVR</span>
                    </div>
                    <div class="relievr-branding">
                        <div class="logo">
                            <i class="fas fa-vr-cardboard"></i>
                            <h1>RelieVR</h1>
                        </div>
                        <p class="tagline">Advanced VR Therapy for Post-Operative Recovery</p>
                    </div>
                </div>
            </div>
        </header>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <main class="main-content">
            <!-- Step 0: Patient and Doctor Information -->
            <section class="step-section active" id="step0">
                <div class="step-header">
                    <h2><i class="fas fa-user-md"></i> Patient Information</h2>
                    <p>Please provide your details to begin the VR therapy session</p>
                </div>
                
                <div class="info-form-container">
                    <div class="form-card">
                        <div class="form-group">
                            <label for="patientName">
                                <i class="fas fa-user"></i>
                                Patient Name
                            </label>
                            <input type="text" id="patientName" placeholder="Enter your full name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="doctorName">
                                <i class="fas fa-user-md"></i>
                                Doctor Name
                            </label>
                            <input type="text" id="doctorName" placeholder="Enter your doctor's name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="patientAge">
                                <i class="fas fa-calendar"></i>
                                Age
                            </label>
                            <input type="number" id="patientAge" placeholder="Enter your age" min="1" max="120" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="treatmentType">
                                <i class="fas fa-stethoscope"></i>
                                Treatment Type
                            </label>
                            <select id="treatmentType" required>
                                <option value="">Select treatment type</option>
                                <option value="post-surgery">Post-Surgery Recovery</option>
                                <option value="pain-management">Pain Management</option>
                                <option value="anxiety-relief">Anxiety Relief</option>
                                <option value="physical-therapy">Physical Therapy</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <button class="btn-primary" id="submitPatientInfo">
                    Begin Assessment <i class="fas fa-arrow-right"></i>
                </button>
            </section>

            <!-- Step 1: Pre-Assessment Questionnaire -->
            <section class="step-section" id="step1">
                <div class="step-header">
                    <h2><i class="fas fa-clipboard-list"></i> Pre-Treatment Assessment</h2>
                    <p>Please answer the following questions honestly to personalize your VR therapy experience</p>
                </div>
                
                <div class="questionnaire-container" id="preQuestionnaire">
                    <!-- Questions will be dynamically generated -->
                </div>
                
                <button class="btn-primary" id="submitPreAssessment">
                    Start VR Therapy <i class="fas fa-vr-cardboard"></i>
                </button>
            </section>

            <!-- Step 2: VR Therapy Session -->
            <section class="step-section" id="step2">
                <div class="step-header">
                    <h2><i class="fas fa-vr-cardboard"></i> VR Therapy Session</h2>
                    <p>Your personalized 3-minute VR therapy experience</p>
                </div>
                
                <div class="vr-container">
                    <div class="therapy-recommendation" id="therapyRecommendation">
                        <!-- Recommendation will be displayed here -->
                    </div>
                    
                    <div class="vr-status" id="vrStatus">
                        <div class="vr-message">
                            <i class="fas fa-cube"></i>
                            <h3>VR Therapy Ready</h3>
                            <p>Your 3-minute VR therapy will begin automatically in fullscreen mode</p>
                            <div class="vr-features">
                                <span class="feature-tag"><i class="fas fa-expand"></i> Auto Fullscreen</span>
                                <span class="feature-tag"><i class="fas fa-clock"></i> 3 Minutes</span>
                                <span class="feature-tag"><i class="fas fa-globe"></i> Immersive Experience</span>
                            </div>
                        </div>
                        
                        <div class="session-timer">
                            <i class="fas fa-clock"></i>
                            <span id="sessionTime">00:00</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 3: Post-Assessment -->
            <section class="step-section" id="step3">
                <div class="step-header">
                    <h2><i class="fas fa-chart-line"></i> Post-Treatment Assessment</h2>
                    <p>Let's see how you're feeling after the VR therapy session</p>
                </div>
                
                <div class="questionnaire-container" id="postQuestionnaire">
                    <!-- Post-assessment questions -->
                </div>
                
                <button class="btn-primary" id="submitPostAssessment">
                    Complete Assessment <i class="fas fa-check"></i>
                </button>
            </section>

            <!-- Step 4: Results & Follow-up -->
            <section class="step-section" id="step4">
                <div class="step-header">
                    <h2><i class="fas fa-trophy"></i> Treatment Results & Follow-up</h2>
                    <p>Here's your progress summary and next steps</p>
                </div>
                
                <div class="results-container" id="resultsContainer">
                    <!-- Results will be displayed here -->
                </div>
                
                <div class="followup-schedule">
                    <div class="schedule-card">
                        <div class="schedule-header">
                            <i class="fas fa-calendar-alt"></i>
                            <h3>Recommended Follow-up Schedule</h3>
                        </div>
                        <div class="schedule-timeline">
                            <div class="timeline-item">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <h4>Next Session</h4>
                                    <p>3 days from today</p>
                                    <small>Continue VR therapy for optimal recovery</small>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <h4>Weekly Check-in</h4>
                                    <p>1 week from today</p>
                                    <small>Progress evaluation with healthcare provider</small>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <h4>Monthly Review</h4>
                                    <p>1 month from today</p>
                                    <small>Comprehensive recovery assessment</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn-secondary" id="downloadReport">
                        <i class="fas fa-download"></i> Download PDF Report
                    </button>
                    <button class="btn-primary" id="scheduleFollowup">
                        <i class="fas fa-calendar"></i> Schedule Next Session
                    </button>
                </div>
            </section>
        </main>

        <!-- VR Fullscreen Modal -->
        <div class="vr-fullscreen-modal" id="vrModal">
            <div class="vr-overlay">
                <div class="vr-header">
                    <h3><i class="fas fa-vr-cardboard"></i> VR Therapy Session Active</h3>
                    <div class="session-info">
                        <span id="currentVideoInfo">3-Minute Therapy Session</span>
                        <span id="modalSessionTime">00:00</span>
                    </div>
                </div>
                
                <video id="vrVideo" 
                       preload="auto" 
                       crossorigin="anonymous"
                       playsinline
                       style="display: block; width: 100%; height: 100%; object-fit: cover; background: #000;">
                    <source src="videos/vr-therapy.mp4" type="video/mp4">
                    <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
                    Your browser does not support VR video playback.
                </video>
                
                <div class="vr-progress">
                    <div class="vr-progress-bar">
                        <div class="vr-progress-fill" id="vrProgressFill"></div>
                    </div>
                    <p id="vrProgressText">VR therapy session in progress...</p>
                </div>
                
                <button class="emergency-exit" id="emergencyExit">
                    <i class="fas fa-times"></i> Emergency Exit
                </button>
            </div>
        </div>
    </div>

    <script>
        class RelieVRApp {
          constructor() {
            this.currentStep = 0
            this.totalSteps = 5
            this.patientInfo = {}
            this.preAssessmentData = {}
            this.postAssessmentData = {}
            this.sessionStartTime = null
            this.sessionTimer = null
            this.vrVideo = null
            this.vrProgressInterval = null

            this.init()
          }

          init() {
            this.setupEventListeners()
            this.generateQuestionnaires()
            this.updateProgress()
          }

          setupEventListeners() {
            document.getElementById("submitPatientInfo").addEventListener("click", () => {
              this.handlePatientInfoSubmit()
            })

            document.getElementById("submitPreAssessment").addEventListener("click", () => {
              this.handlePreAssessmentSubmit()
            })

            document.getElementById("submitPostAssessment").addEventListener("click", () => {
              this.handlePostAssessmentSubmit()
            })

            document.getElementById("emergencyExit").addEventListener("click", () => {
              this.exitVRSession()
            })

            document.getElementById("downloadReport").addEventListener("click", () => {
              this.downloadPDFReport()
            })

            document.getElementById("scheduleFollowup").addEventListener("click", () => {
              this.scheduleFollowup()
            })
          }

          handlePatientInfoSubmit() {
            const patientName = document.getElementById("patientName").value.trim()
            const doctorName = document.getElementById("doctorName").value.trim()
            const patientAge = document.getElementById("patientAge").value
            const treatmentType = document.getElementById("treatmentType").value

            if (!patientName || !doctorName || !patientAge || !treatmentType) {
              alert("Please fill in all required fields.")
              return
            }

            this.patientInfo = {
              patientName,
              doctorName,
              patientAge,
              treatmentType,
              sessionDate: new Date().toLocaleDateString(),
            }

            this.nextStep()
          }

          generateQuestionnaires() {
            this.generatePreAssessment()
            this.generatePostAssessment()
          }

          generatePreAssessment() {
            const container = document.getElementById("preQuestionnaire")
            const questions = [
              {
                id: "stress_emoji",
                type: "emoji",
                text: "How are you feeling right now? Select the emoji that best represents your current emotional state.",
                emojis: ["😢", "😟", "😐", "🙂", "😊"],
                labels: ["Very Sad", "Worried", "Neutral", "Good", "Very Happy"],
              },
              {
                id: "pain_level",
                type: "scale",
                text: "On a scale of 1-10, how would you rate your current pain level?",
                min: 1,
                max: 10,
              },
              {
                id: "anxiety_emoji",
                type: "emoji",
                text: "How anxious do you feel about your recovery?",
                emojis: ["😰", "😨", "😕", "😌", "😎"],
                labels: ["Very Anxious", "Anxious", "Somewhat Worried", "Calm", "Very Confident"],
              },
              {
                id: "mood_color",
                type: "color",
                text: "Which color best represents your current mood?",
                colors: ["#FF6B6B", "#4ECDC4", "#45B7D1", "#96CEB4", "#FFEAA7", "#DDA0DD", "#98D8C8"],
              },
              {
                id: "energy_level",
                type: "emoji",
                text: "How is your energy level today?",
                emojis: ["😴", "😪", "😐", "😊", "⚡"],
                labels: ["Very Tired", "Tired", "Neutral", "Energetic", "Very Energetic"],
              },
              {
                id: "overall_wellbeing",
                type: "scale",
                text: "Overall, how would you rate your current wellbeing?",
                min: 1,
                max: 10,
              },
              {
                id: "sleep_quality",
                type: "scale",
                text: "How would you rate your sleep quality last night?",
                min: 1,
                max: 10,
              },
              {
                id: "appetite_level",
                type: "emoji",
                text: "How is your appetite today?",
                emojis: ["🚫", "😕", "😐", "😋", "🍽️"],
                labels: ["No Appetite", "Poor", "Normal", "Good", "Excellent"],
              },
              {
                id: "mobility_level",
                type: "scale",
                text: "How would you rate your current mobility/movement ability?",
                min: 1,
                max: 10,
              },
              {
                id: "concentration",
                type: "emoji",
                text: "How is your ability to concentrate today?",
                emojis: ["😵", "😕", "😐", "🤔", "🎯"],
                labels: ["Very Poor", "Poor", "Average", "Good", "Excellent"],
              },
              {
                id: "social_comfort",
                type: "scale",
                text: "How comfortable do you feel interacting with others today?",
                min: 1,
                max: 10,
              },
              {
                id: "motivation_level",
                type: "emoji",
                text: "How motivated do you feel about your recovery today?",
                emojis: ["😞", "😕", "😐", "💪", "🚀"],
                labels: ["Very Low", "Low", "Neutral", "High", "Very High"],
              },
              {
                id: "breathing_comfort",
                type: "scale",
                text: "How comfortable is your breathing right now?",
                min: 1,
                max: 10,
              },
              {
                id: "nausea_level",
                type: "emoji",
                text: "Are you experiencing any nausea or dizziness?",
                emojis: ["🤢", "😷", "😕", "😐", "😊"],
                labels: ["Very Nauseous", "Somewhat Nauseous", "Mild Discomfort", "Slight", "None"],
              },
              {
                id: "temperature_comfort",
                type: "scale",
                text: "How comfortable is your body temperature right now?",
                min: 1,
                max: 10,
              },
              {
                id: "optimism_level",
                type: "emoji",
                text: "How optimistic do you feel about your recovery?",
                emojis: ["😔", "😟", "😐", "🙂", "🌟"],
                labels: ["Very Pessimistic", "Pessimistic", "Neutral", "Optimistic", "Very Optimistic"],
              },
              {
                id: "stress_physical",
                type: "scale",
                text: "How much physical tension or stress do you feel in your body?",
                min: 1,
                max: 10,
              },
              {
                id: "comfort_environment",
                type: "emoji",
                text: "How comfortable do you feel in your current environment?",
                emojis: ["😰", "😕", "😐", "😌", "🏠"],
                labels: ["Very Uncomfortable", "Uncomfortable", "Neutral", "Comfortable", "Very Comfortable"],
              },
              {
                id: "recovery_confidence",
                type: "scale",
                text: "How confident are you in your recovery process?",
                min: 1,
                max: 10,
              },
              {
                id: "support_feeling",
                type: "emoji",
                text: "How supported do you feel by your healthcare team and family?",
                emojis: ["😞", "😕", "😐", "🤗", "❤️"],
                labels: ["Not Supported", "Slightly Supported", "Neutral", "Well Supported", "Very Supported"],
              },
            ]

            questions.forEach((question, index) => {
              const questionCard = this.createQuestionCard(question, index + 1)
              container.appendChild(questionCard)
            })
          }

          generatePostAssessment() {
            const container = document.getElementById("postQuestionnaire")
            const questions = [
              {
                id: "post_stress_emoji",
                type: "emoji",
                text: "After the VR therapy session, how are you feeling now?",
                emojis: ["😢", "😟", "😐", "🙂", "😊"],
                labels: ["Very Sad", "Worried", "Neutral", "Good", "Very Happy"],
              },
              {
                id: "post_pain_level",
                type: "scale",
                text: "How would you rate your pain level now after the VR session?",
                min: 1,
                max: 10,
              },
              {
                id: "post_anxiety_emoji",
                type: "emoji",
                text: "How anxious do you feel about your recovery now?",
                emojis: ["😰", "😨", "😕", "😌", "😎"],
                labels: ["Very Anxious", "Anxious", "Somewhat Worried", "Calm", "Very Confident"],
              },
              {
                id: "post_overall_wellbeing",
                type: "scale",
                text: "Overall, how would you rate your wellbeing after the VR session?",
                min: 1,
                max: 10,
              },
              {
                id: "post_relaxation",
                type: "emoji",
                text: "How relaxed do you feel after the VR experience?",
                emojis: ["😤", "😕", "😐", "😌", "🧘"],
                labels: ["Very Tense", "Tense", "Neutral", "Relaxed", "Very Relaxed"],
              },
              {
                id: "post_energy_level",
                type: "emoji",
                text: "How is your energy level after the VR session?",
                emojis: ["😴", "😪", "😐", "😊", "⚡"],
                labels: ["Very Tired", "Tired", "Neutral", "Energetic", "Very Energetic"],
              },
              {
                id: "post_motivation_level",
                type: "emoji",
                text: "How motivated do you feel about your recovery now?",
                emojis: ["😞", "😕", "😐", "💪", "🚀"],
                labels: ["Very Low", "Low", "Neutral", "High", "Very High"],
              },
              {
                id: "post_optimism_level",
                type: "emoji",
                text: "How optimistic do you feel about your recovery now?",
                emojis: ["😔", "😟", "😐", "🙂", "🌟"],
                labels: ["Very Pessimistic", "Pessimistic", "Neutral", "Optimistic", "Very Optimistic"],
              },
              {
                id: "post_recovery_confidence",
                type: "scale",
                text: "How confident are you in your recovery process now?",
                min: 1,
                max: 10,
              },
              {
                id: "vr_experience_rating",
                type: "emoji",
                text: "How would you rate your overall VR therapy experience?",
                emojis: ["😞", "😕", "😐", "😊", "🌟"],
                labels: ["Poor", "Fair", "Good", "Very Good", "Excellent"],
              },
            ]

            questions.forEach((question, index) => {
              const questionCard = this.createQuestionCard(question, index + 1, "post")
              container.appendChild(questionCard)
            })
          }

          createQuestionCard(question, number, prefix = "pre") {
            const card = document.createElement("div")
            card.className = "question-card"

            let optionsHTML = ""

            switch (question.type) {
              case "emoji":
                optionsHTML = `
                            <div class="emoji-options">
                                ${question.emojis
                                  .map(
                                    (emoji, index) => `
                                    <div class="emoji-option" data-value="${index + 1}" data-question="${prefix}_${question.id}" title="${question.labels[index]}">
                                        ${emoji}
                                    </div>
                                `,
                                  )
                                  .join("")}
                            </div>
                        `
                break

              case "scale":
                optionsHTML = `
                            <div class="scale-options">
                                ${Array.from(
                                  { length: question.max - question.min + 1 },
                                  (_, i) => `
                                    <div class="scale-option" data-value="${question.min + i}" data-question="${prefix}_${question.id}">
                                        ${question.min + i}
                                    </div>
                                `,
                                ).join("")}
                            </div>
                        `
                break

              case "color":
                optionsHTML = `
                            <div class="color-options">
                                ${question.colors
                                  .map(
                                    (color, index) => `
                                    <div class="color-option" style="background-color: ${color}" data-value="${color}" data-question="${prefix}_${question.id}"></div>
                                `,
                                  )
                                  .join("")}
                            </div>
                        `
                break
            }

            card.innerHTML = `
                    <div class="question-header">
                        <div class="question-number">${number}</div>
                        <div class="question-text">${question.text}</div>
                    </div>
                    ${optionsHTML}
                `

            const options = card.querySelectorAll("[data-question]")
            options.forEach((option) => {
              option.addEventListener("click", () => {
                options.forEach((opt) => opt.classList.remove("selected"))
                option.classList.add("selected")
              })
            })

            return card
          }

          handlePreAssessmentSubmit() {
            this.preAssessmentData = this.collectAssessmentData("pre")
            this.generateVRRecommendation()
            this.nextStep()
            setTimeout(() => {
              this.startVRSession()
            }, 2000)
          }

          handlePostAssessmentSubmit() {
            this.postAssessmentData = this.collectAssessmentData("post")

            const requiredQuestions = 10
            const answeredQuestions = Object.keys(this.postAssessmentData).length

            if (answeredQuestions < requiredQuestions) {
              alert(
                `Please answer all ${requiredQuestions} questions before proceeding. You have answered ${answeredQuestions} out of ${requiredQuestions} questions.`,
              )
              return
            }

            this.generateResults()
            this.nextStep()
          }

          collectAssessmentData(prefix) {
            const data = {}
            const questions = document.querySelectorAll(`[data-question^="${prefix}_"]`)

            questions.forEach((question) => {
              const questionId = question.dataset.question

              if (question.classList.contains("selected")) {
                data[questionId] = question.dataset.value
              }
            })

            return data
          }

          generateVRRecommendation() {
            const container = document.getElementById("therapyRecommendation")
            const stressLevel = Number.parseInt(this.preAssessmentData.pre_stress_emoji) || 3
            const painLevel = Number.parseInt(this.preAssessmentData.pre_pain_level) || 5
            const anxietyLevel = Number.parseInt(this.preAssessmentData.pre_anxiety_emoji) || 3

            let recommendation = ""

            if (stressLevel <= 2 && anxietyLevel <= 2) {
              recommendation = `
                        <h3><i class="fas fa-leaf"></i> Calming Nature Experience</h3>
                        <p>Based on your stress and anxiety levels, we recommend a peaceful nature experience to help you relax and find inner calm.</p>
                    `
            } else if (painLevel >= 7) {
              recommendation = `
                        <h3><i class="fas fa-spa"></i> Pain Management Therapy</h3>
                        <p>We've selected a specialized VR experience designed to help manage pain through guided meditation and visualization techniques.</p>
                    `
            } else {
              recommendation = `
                        <h3><i class="fas fa-heart"></i> Positive Healing Journey</h3>
                        <p>Your assessment shows you're on a good path. This uplifting VR experience will boost your mood and accelerate your healing process.</p>
                    `
            }

            container.innerHTML = recommendation
          }

          startVRSession() {
            const modal = document.getElementById("vrModal")
            modal.classList.add("active")

            const requestFullscreen = () => {
              if (modal.requestFullscreen) {
                return modal.requestFullscreen()
              } else if (modal.webkitRequestFullscreen) {
                return modal.webkitRequestFullscreen()
              } else if (modal.msRequestFullscreen) {
                return modal.msRequestFullscreen()
              }
              return Promise.resolve()
            }

            requestFullscreen()
              .then(() => {
                this.sessionStartTime = Date.now()
                this.startSessionTimer()

                setTimeout(() => {
                  this.playVRVideo()
                }, 100)
              })
              .catch((e) => {
                this.sessionStartTime = Date.now()
                this.startSessionTimer()

                setTimeout(() => {
                  this.playVRVideo()
                }, 100)
              })
          }

          playVRVideo() {
            const video = document.getElementById("vrVideo")
            const currentVideoInfo = document.getElementById("currentVideoInfo")
            const progressText = document.getElementById("vrProgressText")

            currentVideoInfo.textContent = "3-Minute Therapy Session"
            progressText.textContent = "VR therapy session in progress..."

            video.load()
            video.muted = false
            video.volume = 0.7

            const playPromise = video.play()
            if (playPromise !== undefined) {
              playPromise
                .then(() => {
                  this.updateVRProgress()
                  setTimeout(() => {
                    this.completeVRSession()
                  }, 180000)
                })
                .catch((e) => {
                  video.muted = true
                  video.play().catch(() => {
                    setTimeout(() => {
                      this.completeVRSession()
                    }, 180000)
                  })
                })
            }
          }

          updateVRProgress() {
            const progressFill = document.getElementById("vrProgressFill")
            const startTime = Date.now()

            this.vrProgressInterval = setInterval(() => {
              const elapsed = Date.now() - startTime
              const progress = Math.min((elapsed / 180000) * 100, 100)
              progressFill.style.width = `${progress}%`

              if (elapsed >= 180000) {
                this.completeVRSession()
              }
            }, 1000)
          }

          completeVRSession() {
            if (this.vrProgressInterval) {
              clearInterval(this.vrProgressInterval)
            }

            const progressText = document.getElementById("vrProgressText")
            const progressFill = document.getElementById("vrProgressFill")

            progressText.textContent = "VR therapy session completed!"
            progressFill.style.width = "100%"

            setTimeout(() => {
              this.exitVRSession()
              this.nextStep()
            }, 3000)
          }

          exitVRSession() {
            const modal = document.getElementById("vrModal")
            modal.classList.remove("active")

            document.getElementById("vrVideo").pause()

            if (this.vrProgressInterval) {
              clearInterval(this.vrProgressInterval)
            }

            if (document.exitFullscreen) {
              document.exitFullscreen()
            } else if (document.webkitExitFullscreen) {
              document.webkitExitFullscreen()
            } else if (document.msExitFullscreen) {
              document.msExitFullscreen()
            }
          }

          startSessionTimer() {
            this.sessionTimer = setInterval(() => {
              if (this.sessionStartTime) {
                const elapsed = Date.now() - this.sessionStartTime
                const minutes = Math.floor(elapsed / 60000)
                const seconds = Math.floor((elapsed % 60000) / 1000)
                const timeString = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`

                document.getElementById("sessionTime").textContent = timeString
                document.getElementById("modalSessionTime").textContent = timeString
              }
            }, 1000)
          }

          generateResults() {
            const container = document.getElementById("resultsContainer")

            const stressImprovement = this.calculateImprovement("stress_emoji")
            const painImprovement = this.calculateImprovement("pain_level")
            const anxietyImprovement = this.calculateImprovement("anxiety_emoji")
            const wellbeingImprovement = this.calculateImprovement("overall_wellbeing")

            const sessionDuration = this.sessionStartTime ? Math.floor((Date.now() - this.sessionStartTime) / 60000) : 3

            container.innerHTML = `
                    <div class="result-card">
                        <div class="result-header">
                            <i class="result-icon fas fa-chart-line"></i>
                            <h3>Treatment Progress Summary</h3>
                        </div>
                        <p><strong>Patient:</strong> ${this.patientInfo.patientName || "N/A"}</p>
                        <p><strong>Doctor:</strong> ${this.patientInfo.doctorName || "N/A"}</p>
                        <p><strong>Session Duration:</strong> ${sessionDuration} minutes</p>
                        <p><strong>Treatment Date:</strong> ${this.patientInfo.sessionDate || new Date().toLocaleDateString()}</p>
                        <p><strong>VR Therapy Type:</strong> Personalized Recovery Experience</p>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-header">
                            <i class="result-icon fas fa-smile"></i>
                            <h3>Stress Level Improvement</h3>
                        </div>
                        <p>Improvement: ${stressImprovement}%</p>
                        <div class="improvement-bar">
                            <div class="improvement-fill" style="width: ${Math.max(0, stressImprovement)}%"></div>
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-header">
                            <i class="result-icon fas fa-heart"></i>
                            <h3>Pain Level Improvement</h3>
                        </div>
                        <p>Improvement: ${painImprovement}%</p>
                        <div class="improvement-bar">
                            <div class="improvement-fill" style="width: ${Math.max(0, painImprovement)}%"></div>
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-header">
                            <i class="result-icon fas fa-brain"></i>
                            <h3>Anxiety Level Improvement</h3>
                        </div>
                        <p>Improvement: ${anxietyImprovement}%</p>
                        <div class="improvement-bar">
                            <div class="improvement-fill" style="width: ${Math.max(0, anxietyImprovement)}%"></div>
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-header">
                            <i class="result-icon fas fa-star"></i>
                            <h3>Overall Wellbeing</h3>
                        </div>
                        <p>Improvement: ${wellbeingImprovement}%</p>
                        <div class="improvement-bar">
                            <div class="improvement-fill" style="width: ${Math.max(0, wellbeingImprovement)}%"></div>
                        </div>
                    </div>
                `
          }

          calculateImprovement(metric) {
            const preKey = `pre_${metric}`
            const postKey = `post_${metric}`

            const preValue = Number.parseInt(this.preAssessmentData[preKey]) || 0
            const postValue = Number.parseInt(this.postAssessmentData[postKey]) || 0

            if (preValue === 0 && postValue === 0) {
              return 0
            }

            if (preValue === 0) {
              if (
                metric.includes("pain") ||
                metric.includes("anxiety") ||
                metric.includes("stress") ||
                metric.includes("nausea")
              ) {
                return postValue === 0 ? 100 : Math.max(0, 100 - postValue * 10)
              } else {
                return Math.min(100, postValue * 10)
              }
            }

            if (
              metric.includes("pain") ||
              metric.includes("anxiety") ||
              metric.includes("stress") ||
              metric.includes("nausea")
            ) {
              const improvement = ((preValue - postValue) / preValue) * 100
              return Math.round(Math.max(0, Math.min(100, improvement)))
            } else {
              const improvement = ((postValue - preValue) / preValue) * 100
              return Math.round(Math.max(0, Math.min(100, improvement)))
            }
          }

          downloadPDFReport() {
            const { jsPDF } = window.jspdf
            const doc = new jsPDF()

            doc.setFontSize(24)
            doc.setTextColor(255, 107, 107)
            doc.text("RelieVR", 20, 30)

            doc.setFontSize(16)
            doc.setTextColor(78, 205, 196)
            doc.text("VR Therapy Report", 20, 45)

            doc.setFontSize(14)
            doc.setTextColor(0, 0, 0)
            doc.text("Patient Information", 20, 70)
            doc.setFontSize(12)
            doc.text(`Patient Name: ${this.patientInfo.patientName || "N/A"}`, 20, 85)
            doc.text(`Doctor Name: ${this.patientInfo.doctorName || "N/A"}`, 20, 95)
            doc.text(`Age: ${this.patientInfo.patientAge || "N/A"}`, 20, 105)
            doc.text(`Treatment Type: ${this.patientInfo.treatmentType || "N/A"}`, 20, 115)

            const sessionDuration = this.sessionStartTime ? Math.floor((Date.now() - this.sessionStartTime) / 60000) : 3
            doc.text(`Session Date: ${this.patientInfo.sessionDate || new Date().toLocaleDateString()}`, 20, 125)
            doc.text(`Session Duration: ${sessionDuration} minutes`, 20, 135)
            doc.text(`Therapy Type: Personalized Recovery Experience`, 20, 145)

            doc.setFontSize(14)
            doc.text("Pre-Assessment Results", 20, 170)
            doc.setFontSize(12)
            let yPos = 185

            Object.entries(this.preAssessmentData).forEach(([key, value]) => {
              if (yPos > 270) {
                doc.addPage()
                yPos = 20
              }
              const cleanKey = key.replace("pre_", "").replace("_", " ").toUpperCase()
              doc.text(`${cleanKey}: ${value}`, 20, yPos)
              yPos += 10
            })

            if (yPos > 250) {
              doc.addPage()
              yPos = 20
            }

            doc.setFontSize(14)
            doc.text("Post-Assessment Results", 20, yPos)
            yPos += 15
            doc.setFontSize(12)

            Object.entries(this.postAssessmentData).forEach(([key, value]) => {
              if (yPos > 270) {
                doc.addPage()
                yPos = 20
              }
              const cleanKey = key.replace("post_", "").replace("_", " ").toUpperCase()
              doc.text(`${cleanKey}: ${value}`, 20, yPos)
              yPos += 10
            })

            if (yPos > 230) {
              doc.addPage()
              yPos = 20
            }

            doc.setFontSize(14)
            doc.text("Treatment Improvements", 20, yPos)
            yPos += 15
            doc.setFontSize(12)

            const stressImprovement = this.calculateImprovement("stress_emoji")
            const painImprovement = this.calculateImprovement("pain_level")
            const anxietyImprovement = this.calculateImprovement("anxiety_emoji")
            const wellbeingImprovement = this.calculateImprovement("overall_wellbeing")

            doc.text(`Stress Level Improvement: ${stressImprovement}%`, 20, yPos)
            doc.text(`Pain Level Improvement: ${painImprovement}%`, 20, yPos + 10)
            doc.text(`Anxiety Level Improvement: ${anxietyImprovement}%`, 20, yPos + 20)
            doc.text(`Overall Wellbeing Improvement: ${wellbeingImprovement}%`, 20, yPos + 30)

            const fileName = `relievr-report-${this.patientInfo.patientName?.replace(/\s+/g, "-") || "patient"}-${new Date().toISOString().split("T")[0]}.pdf`
            doc.save(fileName)
          }

          scheduleFollowup() {
            alert(
              "Follow-up scheduling feature will be available soon. Please contact your healthcare provider to schedule your next VR therapy session.",
            )
          }

          nextStep() {
            document.querySelector(".step-section.active").classList.remove("active")

            this.currentStep++
            document.getElementById(`step${this.currentStep}`).classList.add("active")

            this.updateProgress()
          }

          updateProgress() {
            const progressFill = document.getElementById("progressFill")

            const percentage = (this.currentStep / this.totalSteps) * 100
            progressFill.style.width = `${percentage}%`
          }
        }

        document.addEventListener("DOMContentLoaded", () => {
          new RelieVRApp()
        })
    </script>
</body>
</html>
